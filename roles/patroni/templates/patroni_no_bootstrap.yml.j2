scope: {{ patroni_cluster_name }}
namespace: {{ patroni_namespace }}
name: {{ patroni_node_name | default(inventory_hostname) }}

restapi:
  listen: {{ patroni_ip }}:{{ patroni_rest_port }}
  connect_address: {{ patroni_ip }}:{{ patroni_rest_port }}

etcd3:
  hosts: "{% for h in groups[patroni_group] -%}{{ hostvars[h].patroni_ip }}:{{ etcd_client_port }}{% if not loop.last %},{% endif %}{%- endfor %}"

postgresql:
  listen: {{ patroni_ip }}:{{ postgres_listen_port }}
  connect_address: {{ patroni_ip }}:{{ postgres_listen_port }}
  data_dir: {{ pg_data_dir }}
  bin_dir: {{ pg_bin_dir }}
  pgpass: /tmp/pgpass
  authentication:
    replication:
      username: {{ patroni_auth.replication.username }}
      password: {{ patroni_auth.replication.password }}
    superuser:
      username: {{ patroni_auth.superuser.username }}
      password: {{ patroni_auth.superuser.password }}
    rewind:
      username: {{ patroni_auth.rewind.username }}
      password: {{ patroni_auth.rewind.password }}
  parameters:
    unix_socket_directories: '/var/run/postgresql'

tags:
{% for k, v in patroni_tags.items() %}
  {{ k }}: {{ v }}
{% endfor %}
